#===============================================================================
# PAQET MIDDLE VPS — DaaS Edition (Docker Compose)
#
# Traffic chain:
#   Your Device (Shadowrocket) → This VPS (VLESS) → Server VPS (paqet)
#
# INSTRUCTIONS:
#   1. Clone the repo or copy Dockerfile.middle + client/docker/daas-entrypoint.sh
#   2. Change SERVER_IP, SERVER_PORT, SECRET_KEY below
#   3. Run: docker compose -f client/docker-compose.daas.yml up -d --build
#   4. Check container logs for your VLESS config
#
# Single container runs paqet + sing-box — no external images needed!
#===============================================================================

services:
  paqet-middle:
    build:
      context: .
      dockerfile: Dockerfile.middle
    container_name: paqet-middle
    restart: unless-stopped
    privileged: true
    cap_add:
      - NET_ADMIN
      - NET_RAW
    ports:
      - "443:443"
    environment:
      # ═══════════════════════════════════════════════════════════════════
      #  REQUIRED — Change these
      # ═══════════════════════════════════════════════════════════════════
      - SERVER_IP=CHANGE_ME                        # ← Your paqet server IP
      - SERVER_PORT=9999                           # ← Your paqet server port
      - SECRET_KEY=CHANGE_ME                       # ← Your paqet secret key
      # ═══════════════════════════════════════════════════════════════════
      #  Optional — defaults work fine
      # ═══════════════════════════════════════════════════════════════════
      - REALITY_TRANSPORT=tcp                      # tcp, grpc, or ws
      - REALITY_PORT=443
      - REALITY_SNI=www.google.com
      - INITIAL_USER=default
      - DAAS_DOMAIN=                               # Your DaaS domain (e.g. xxx.darkube.app)
      - DAAS_PORT=443                              # External port of your domain
      - PAQET_VERSION=v1.0.0-alpha.14
    volumes:
      - paqet-data:/opt/data
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: "3"

volumes:
  paqet-data:
