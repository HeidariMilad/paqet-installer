#===============================================================================
# PAQET MIDDLE VPS — DaaS Edition (Docker Compose)
#
# Traffic chain:
#   Your Mac/Phone (Shadowrocket) → This VPS (VLESS WS) → Server VPS (paqet)
#
# INSTRUCTIONS:
#   1. Change SERVER_IP, SERVER_PORT, SECRET_KEY below
#   2. Change DAAS_DOMAIN to your DaaS domain (e.g. xxxx.hsvc.ir)
#   3. Paste this file into your DaaS provider
#   4. After startup, get your VLESS config:
#      docker exec paqet-middle cat /opt/data/user-config.txt
#      OR check the container logs
#
# USER MANAGEMENT:
#   docker exec paqet-middle bash /opt/data/manage-users.sh add <username>
#   docker exec paqet-middle bash /opt/data/manage-users.sh list
#   docker exec paqet-middle bash /opt/data/manage-users.sh show
#===============================================================================

services:
  paqet-middle:
    image: debian:bookworm-slim
    container_name: paqet-middle
    restart: unless-stopped
    privileged: true
    cap_add:
      - NET_ADMIN
      - NET_RAW
    ports:
      - "8080:8080"               # Internal VLESS WS port (map this in DaaS)
    environment:
      # ═══════════════════════════════════════════════════════════════════
      #  REQUIRED — Change these
      # ═══════════════════════════════════════════════════════════════════
      - SERVER_IP=CHANGE_ME              # ← Your paqet server IP
      - SERVER_PORT=9999                 # ← Your paqet server port
      - SECRET_KEY=CHANGE_ME             # ← Your paqet secret key
      - DAAS_DOMAIN=CHANGE_ME            # ← Your DaaS domain (e.g. xxxx.hsvc.ir)
      # ═══════════════════════════════════════════════════════════════════
      #  Transport — WebSocket mode (works behind DaaS proxy)
      # ═══════════════════════════════════════════════════════════════════
      - REALITY_TRANSPORT=ws
      - REALITY_PORT=8080
      - DAAS_PORT=443                    # External HTTPS port of your DaaS domain
      - WS_PATH=/vless-ws
      - REALITY_SNI=www.google.com
      - INITIAL_USER=default
      - PAQET_VERSION=v1.0.0-alpha.14
    volumes:
      - paqet-data:/opt/data
    entrypoint: ["/bin/bash", "-c"]
    command:
      - apt-get update -qq && apt-get install -y -qq curl > /dev/null 2>&1 && curl -sL https://raw.githubusercontent.com/HeidariMilad/paqet-installer/main/client/docker/daas-entrypoint.sh -o /tmp/start.sh && bash /tmp/start.sh
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: "3"

volumes:
  paqet-data:
